include ../VERSION

CXX           = @CXX@
CXXFLAGS      = @CXXFLAGS@ @MPI_FLAGS@ -DPEBIL_VER="\"$(PEBIL_FULL_VER)\""
EXTRA_FLAGS   =

SRCDIR        = ../src
BINDIR        = ../bin
EXTDIR        = ../external
EXTRA_INC     = -I. -I../include -I$(EXTDIR)/udis86-1.7/ -I../instcode
EXTRA_LIBS    = -L$(SRCDIR) -lpebilinst -L$(EXTDIR)/udis86-1.7/libudis86/.libs -ludis86

TARGETS  = pebil

SRCS  = BasicBlockCounter.C \
	CacheSimulation.C \
	CallReplace.C \
	Classsification.C \
	FunctionCounter.C \
	FunctionTimer.C \
	RareEventCounter.C \
	ThrottleLoop.C

OBJS  =	BasicBlockCounter.o \
	CacheSimulation.o \
	CallReplace.o \
	Classification.o \
	FunctionCounter.o \
	FunctionTimer.o \
	RareEventCounter.o \
	ThrottleLoop.o

all: $(TARGETS)

pebil :	$(OBJS) pebil.o
	$(CXX) $(CXXFLAGS) -o $@ pebil.o $(OBJS) $(EXTRA_INC) $(EXTRA_LIBS)

%.o: %.C
	$(CXX) $(CXXFLAGS) $(EXTRA_FLAGS) -c -o $@ $< $(EXTRA_INC)

clean: 
	rm -f *inst *.static core *.o *.ii *.s $(TARGETS)

depend:
	g++ -E -MM $(INCLUDE) $(SRCS) > DEPENDS

install: $(TARGETS)
	cp $(TARGETS) $(BINDIR)

include DEPENDS
